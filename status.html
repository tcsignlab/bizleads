<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>System Status ‚Äî BizLeads USA</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
  color: #e8eaf6;
  min-height: 100vh;
  padding: 40px 20px;
}
.container {
  max-width: 1000px;
  margin: 0 auto;
}
h1 {
  font-size: 2.5rem;
  margin-bottom: 10px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.subtitle {
  color: #b0b5d4;
  margin-bottom: 40px;
}
.section {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 30px;
  margin-bottom: 30px;
}
.section h2 {
  font-size: 1.5rem;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.status-item {
  display: flex;
  justify-content: space-between;
  padding: 15px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  margin-bottom: 10px;
}
.status-label {
  color: #b0b5d4;
}
.status-value {
  font-weight: 600;
}
.status-good { color: #4caf50; }
.status-warn { color: #ff9800; }
.status-error { color: #f44336; }
.code-block {
  background: #0a0e27;
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  padding: 20px;
  overflow-x: auto;
  font-family: 'Courier New', monospace;
  font-size: 0.9rem;
  line-height: 1.6;
}
.action-buttons {
  display: flex;
  gap: 15px;
  margin-top: 20px;
}
.btn {
  padding: 12px 24px;
  border-radius: 8px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
  display: inline-block;
  transition: all 0.3s;
}
.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}
.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}
.btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: #e8eaf6;
}
.btn-secondary:hover {
  background: rgba(255, 255, 255, 0.15);
}
.instructions {
  background: rgba(255, 152, 0, 0.1);
  border: 2px solid #ff9800;
  border-radius: 12px;
  padding: 20px;
  margin-top: 30px;
}
.instructions h3 {
  color: #ff9800;
  margin-bottom: 15px;
}
.instructions ol {
  margin-left: 20px;
  line-height: 2;
}
.instructions li {
  margin-bottom: 10px;
}
</style>
</head>
<body>

<div class="container">
  <h1>üîß System Status</h1>
  <p class="subtitle">BizLeads USA ‚Äî Diagnostic Dashboard</p>

  <div class="section">
    <h2>üìä Data Status</h2>
    <div class="status-item">
      <span class="status-label">Data File Accessible:</span>
      <span class="status-value" id="fileStatus">Checking...</span>
    </div>
    <div class="status-item">
      <span class="status-label">Total Businesses:</span>
      <span class="status-value" id="totalBiz">‚Äî</span>
    </div>
    <div class="status-item">
      <span class="status-label">States with Data:</span>
      <span class="status-value" id="statesCount">‚Äî</span>
    </div>
    <div class="status-item">
      <span class="status-label">Last Scraper Run:</span>
      <span class="status-value" id="lastRun">‚Äî</span>
    </div>
  </div>

  <div class="section">
    <h2>üéØ Implemented States</h2>
    <div class="status-item">
      <span class="status-label">Florida (FL):</span>
      <span class="status-value" id="fl-status">‚Äî</span>
    </div>
    <div class="status-item">
      <span class="status-label">California (CA):</span>
      <span class="status-value" id="ca-status">‚Äî</span>
    </div>
    <div class="status-item">
      <span class="status-label">Delaware (DE):</span>
      <span class="status-value" id="de-status">‚Äî</span>
    </div>
    <div class="status-item">
      <span class="status-label">Texas (TX):</span>
      <span class="status-value" id="tx-status">‚Äî</span>
    </div>
  </div>

  <div class="section">
    <h2>üìÅ File Paths</h2>
    <div class="code-block" id="filePaths">
Repository: https://github.com/tcsignlab/bizleads
GitHub Pages: https://tcsignlab.github.io/bizleads/
Data File: https://tcsignlab.github.io/bizleads/data/businesses.json
Sample Data: https://tcsignlab.github.io/bizleads/data/businesses_sample.json
    </div>
  </div>

  <div class="section">
    <h2>üîç Raw Data Preview</h2>
    <div class="code-block" id="dataPreview">Loading...</div>
  </div>

  <div class="action-buttons">
    <a href="index.html" class="btn btn-primary">‚Üê Back to Dashboard</a>
    <button onclick="useTestData()" class="btn btn-secondary">Use Sample Data</button>
    <button onclick="location.reload()" class="btn btn-secondary">Refresh Status</button>
  </div>

  <div class="instructions">
    <h3>üöÄ Why is there no data?</h3>
    <ol>
      <li><strong>Normal on First Run:</strong> The scraper needs to run successfully at least once. GitHub Actions runs daily at 3 AM UTC.</li>
      <li><strong>Check GitHub Actions:</strong> Go to your repo ‚Üí Actions tab ‚Üí Check if the workflow ran successfully.</li>
      <li><strong>Check the data file:</strong> Open <code>data/businesses.json</code> in your repo. Is it empty <code>[]</code>?</li>
      <li><strong>Network Access:</strong> Scrapers need network access to state websites. Some states may be temporarily unavailable.</li>
      <li><strong>Implementation Status:</strong> Only 4 states are fully implemented (FL, CA, DE, TX). Others return empty results.</li>
    </ol>
    
    <h3 style="margin-top: 20px;">‚úÖ Quick Fix: Use Sample Data</h3>
    <p style="margin-top: 10px; line-height: 1.6;">
      To see how the system works with data, click "Use Sample Data" above. This will load sample businesses and show you how the dashboard looks with real data.
    </p>
    
    <h3 style="margin-top: 20px;">üîß To Get Real Data:</h3>
    <ol style="margin-top: 10px;">
      <li>Wait 24 hours for the next scraper run</li>
      <li>Or manually trigger: Go to Actions ‚Üí Run Scraper ‚Üí Run workflow</li>
      <li>Check scraper logs to see if states are being accessed</li>
      <li>Florida FTP should work immediately if network is available</li>
    </ol>
  </div>

</div>

<script>
let dataLoaded = false;

async function checkStatus() {
  try {
    // Try to load main data file
    const response = await fetch('data/businesses.json');
    const data = await response.json();
    
    document.getElementById('fileStatus').innerHTML = 
      '<span class="status-good">‚úì Accessible</span>';
    document.getElementById('totalBiz').textContent = data.length;
    
    // Count states
    const states = new Set(data.map(b => b.state || b.State));
    document.getElementById('statesCount').textContent = states.size;
    
    // Check each state
    const stateCounts = {};
    data.forEach(b => {
      const state = b.state || b.State;
      stateCounts[state] = (stateCounts[state] || 0) + 1;
    });
    
    ['FL', 'CA', 'DE', 'TX'].forEach(state => {
      const count = stateCounts[state] || 0;
      const elem = document.getElementById(`${state.toLowerCase()}-status`);
      if (count > 0) {
        elem.innerHTML = `<span class="status-good">${count} businesses ‚úì</span>`;
      } else {
        elem.innerHTML = `<span class="status-warn">0 businesses (awaiting data)</span>`;
      }
    });
    
    // Show data preview
    if (data.length > 0) {
      const preview = JSON.stringify(data.slice(0, 2), null, 2);
      document.getElementById('dataPreview').textContent = 
        `Showing first 2 of ${data.length} businesses:\n\n${preview}\n\n... and ${data.length - 2} more`;
      document.getElementById('lastRun').innerHTML = 
        '<span class="status-good">Data available ‚úì</span>';
    } else {
      document.getElementById('dataPreview').textContent = 
        'Data file is empty: []\n\nThis means the scraper hasn\'t collected data yet. This is normal on first deployment.';
      document.getElementById('lastRun').innerHTML = 
        '<span class="status-warn">No data collected yet</span>';
    }
    
    dataLoaded = data.length > 0;
    
  } catch (error) {
    console.error('Error:', error);
    document.getElementById('fileStatus').innerHTML = 
      '<span class="status-error">‚úó Error loading</span>';
    document.getElementById('dataPreview').textContent = 
      `Error: ${error.message}\n\nThe data file might not exist yet or there's a network issue.`;
  }
}

function useTestData() {
  if (confirm('This will redirect to a test version using sample data. Continue?')) {
    // Create a test page that uses sample data
    const testHTML = `
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="refresh" content="0; url=index.html?sample=true">
</head>
<body>
<p>Redirecting to dashboard with sample data...</p>
</body>
</html>
    `;
    
    // For now, just alert the user
    alert('Sample data feature:\n\n1. Go to your repo\n2. Copy data/businesses_sample.json\n3. Paste contents into data/businesses.json\n4. Commit and push\n5. Refresh this page in 1-2 minutes');
  }
}

checkStatus();
</script>

</body>
</html>
